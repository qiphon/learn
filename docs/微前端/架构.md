# 架构入门

### serverless 架构

serverless Computing 是云计算的一种，就像通常的 IAAS/PAAS/SAAS等云计算一样，FAAS是云计算的一种，
通过FAAS，用户为应用的某一特定功能购买必要的服务。

无服务器计算并不是真的没有服务器，只是服务器被以特定功能的第三方服务代替，因此 serverless cumputing
一词可能并不是十分妥当。实际上工作负载仍然在某个服务器上运行着，只不过我们不需要以任何方式部署、配置、
维护或管理这些服务器，甚至不需要知道所使用 VM 的数量和类型。

serverless computing 将计算机的抽象粒度提升到了函数层次，属于函数即服务（FAAS）。相对于 IAAS、PAAS、
SAAS，FAAS支持更小的计算量与伸缩的粒度，因此在成本和伸缩平滑性上具有更大的优势。

```js
                                     服务器架构演进
            浏览器                                                      浏览器
              ⇓                                                          ⇓
            web服务                ----------------->                 api Gateway
              ⇓                                                          ⇓
      ⇓-------⇓--------⇓                                                SCF（函数运算）    
    文件     数据库     缓存                                     ⇓---------⇓----------⇓
                                                              COS       CDB        CRedis
                                                              
                                                              
小程序 -------> API网关 --------> 云函数 --------> CDB 云数据库
```
### 基本概念

FAAS（function as a server）函数即服务，每个函数都是一个服务，函数可以由任何语言编写，除此之外不需要关心任何运维细节，
比如：计算资源、弹性扩容，而且可以按量计费。支持事件驱动。业界各云厂商都支持 FAAS，各自都有一套工作台、或者可视化工作流
来管理这些函数

BAAS（backend as a server）后端即服务，就是集成了许多中间技术，可以无视环境调用服务，比如数据即服务（数据库服务），缓存
服务等。虽然下面还有很多XASS，但组成 serverless 概念的只有 FAAS + BAAS

PAAS（platform as a server）平台即服务，用户只要上传源代码就可以自动持续集成，并享受高可用服务，如果速度足够快，可以认为
类似 serverless。单随着 docker 为代表的容器技术兴起，以容器为粒度的 PASS 部署逐渐成为主流，是最常用的应用部署方式。比如
中间件、数据库和操作系统等

DAAS（data as a servers）数据即服务，将数据采集、治理、聚合、服务打包起来提供出去。DAAS服务可以应用 serverless 架构

IAAS（infrastructure as a service ）基础设施即服务，比如计算机存储、网络、服务器等基建设施以服务方式提供。

SAAS（software as a server）软件即服务，比如ERP、CRM、邮箱服务等，以软件为粒度提供服务

容器 容器就是隔绝了物理环境的虚拟程序执行环境，而且环境可以被描述、迁移。比较热门的容器是 docker
随着容器数量增多，就出现了管理容器的技术，比较有名的容器编排平台是 Kubernetes 。容器技术是 serverless 架构实现的一种选择，
也是实现的基础。

### 国内serverless厂商

- [阿里云](https://www.aliyun.com/)
- [亚马逊](https://serverless.com/) 开发体验好，有完整的 Demo 和实际的代码
- [cloudflare](https://www.cloudflare.com/zh-cn/) 

### 服务进化

- 传统非 serverLess 架构

    ```js
    customer <--------> server <---------> database
    ```

    在这个架构中，移动应用程序负责呈现界面并处理来自用户的输入，但它将大多数实际逻辑在后端，
    从代码的角度来看，移动应用程序简单轻便，它使用 http 调用后端服务提供的不同 api

    用户管理、身份验证和各种游戏操作都使用同一种语言封装，后端应用程序还与单个关系数据库交互，以便维护正在进行的程序的状态，并存储结果。

    ```js
    // 随着服务器压力的增大，开始做负载均衡，解决服务压力问题
    
                                                后台设备

                                                web Server    <------->  分布式存储
                                                web Server    <------->  分布式存储
    服务api  <---------- LB负载均衡   <------->   web Server    <------->  数据库集群
                                                web Server    <------->  数据库集群
                                                web Server    <------->  缓存集群
                                                web Server    <------->  缓存集群

    ```

- serverless 架构

- serverless 的演进 （物理机 --> 虚拟化 --> 云集算 --> 容器 --> serverless ）

    虚拟机（VM）、容器和无服务器计算，这些技术都用于抽象 IT 基础架构，但这些技术之间存在着显著差异。
    从根本上将，虚拟机抽象硬件，容器虚拟化操作系统，无服务器技术虚拟化运行时，他们之间的差异见下表。
    目前这三种技术之间并不是相互替代的关系，不同技术适用于不同场景，企业应根据实际需要，选择合适的技术。

    ```js
    特性            虚拟机              容器                 无服务计算
    ----------------------------------------------------------------
    缩放单元         虚拟机               应用                 功能
    --------------------------------------------------------------------
    寿命（生命周期）   较长                较短                 非常短（毫秒或秒）
    ----------------------------------------------------------------------
    性能             可预测               较难预测             最不可预测的
    -------------------------------------------------------------------------
    运营成本          高                  中                   低
    ------------------------------------------------------------------------
    操作控制          高                  中                   低
    -------------------------------------------------------------------------
    提供商锁定        中等到高             低                   高 
    --------------------------------------------------------------------------
    ```

    ```js
    serverless (FaaS | BaaS)
    ------------------------
    Applications (functions)
    ------------------------
    Data
    ------------------------
    Runtime
    ------------------------
    Middleware
    ------------------------
    OS
    -----------------------
    Virtualization
    -----------------------
    servers
    -----------------------
    Storage
    -----------------------
    Networking
    -----------------------
    ```

- 优点
    
    降低人工成本、降低风险、降低资源投入成本

- 阿里云开发流程（基于docker,推荐使用 linux，mac下的docker 不稳定）

    编写代码上传 --> 触发（http、定时、其它函数调用）--> 费用（基于带宽、函数调用次数）
