# http 协议

- 当我们输入网址后发生了什么
    
    ```
    http 请求模型

    client  -------->   server  --------->  client
            请求（req）           相应(res)
    ```
    1. 输入网址并回车
        - 发送dns包

    2. 解析域名
        - 返回 IP地址

    3. 浏览器发送 http 请求
        - 网关记录请求规则
        - 发出数据包 --> 路由中继 (不定数量) --> server

    4. 服务器处理请求
        - 服务器代理请求，转发到指定位置

    5. 服务器返回（HTML）相应
        - 返回数据包

    6. 浏览器处理（HTML）相应
        - 解析服务器数据包

    7. 继续请求其他资源
        - 

- http 协议详解
    - http是超文本传输协议，从 www 浏览器传输到本地浏览器的一种传输协议，网站是基于 http 协议的
    例如网站的图片、css、js等都是基于 http 协议的
    - http 协议是由 ×客户机到服务器的请求request× 和 ×从服务起到客户机的响应reponse× 进行约束和规范
    
    ```
    http 发展

    http/0.9   ----------  http/1.0  ---------- http/1.1 ---------- http2
    1991                   1996                 1999                2015

    ```
    - TCP/IP 协议栈 （标准 7 层， 实际 5层）
        1. 应用层 （应用层、表示层、会话层）
            - 为用户提供所需要的各种服务 ，如 http、ftp、dns、smtp
        2. 传输层（）
            - tcp（传输控制协议）、udp（用户数据报协议）
            - 为应用层实体提供端到端的通信功能，保证数据包的顺序传送即数据的完整性
            
        3. 网络层

        - http 在 tcp/ip 协议栈中的位置

        ```
                        http
                            | ssl/tls
            --------------------------
                        tcp
            --------------------------
                        ip
            --------------------------
                     数据链路层

           http 默认端口 80   https 443
        ```

    - http 的工作过程
        - 一次http 操作称为一个事务，其工作可分为 4 步，一旦一个步骤失败，整个事务失败
            1. 客户端与服务器建立连接  tcp 层
            2. 客户机发送一个请求 请求格式（统一资源标识符URL、协议版本号、mime信息）  Http
            3. 服务端处理请求返回响应  http
            4. 显示结果， 客户机与服务器断开连接  tcp
    
    - 请求与响应 
        - http请求组成：请求行（GET /  ）、消息报头、请求正文
        - http响应组成：状态行(HTTP/1.1 200 OK)、消息报头、响应正文
        - 请求行组成：以一个方法符号开头，后面跟着请求的uri 和 协议的版本
        - 状态行组成：服务器http协议的版本，服务器发回的响应状态代码 和 状态代码的文本描述
    
    - 请求
        
        ```
        # 请求

        请求方法           请求URL   http协议及版本
        ----| ------------------|  -------|
        POST /chapter17/user.html  HTTP/1.1
        Accept:
        Referer:
        Accept-Language：                      -------> 报文头
        。。。

        name=1&pwd=2                           ------->报文体

        
        请求方法 空格 URL 空格 协议版本 回车符换行符    -----> 请求行
        头部字段名：值 回车符换行符                   -----> 请求头
        回车符换行符                            -------> 为了区分头和体
                                                  -----> 请求体

        
        # 响应

        
        

        ascii 一个字节代表一个字符  256 个字符

        ```

        - 请求方法（详情可以参考RFC文档）
            - get        请求获取
            - post       在 request-URI 所标识的资源后附加新的数据
            - head       请求获取由 Request-URI所标识的资源的响应消息报头
            - put        请求服务器存储一个资源
            - delete     请求服务器删除
            - trace      请求服务器回送收到的请求信息
            - connect
            - options     请求查询服务器的性能，或者查询与资源相关的选项和需求
            - connect    http/1.1 中预留
        
        - http状态码
            - 1  指示信息  -- 表示请求已接收，继续处理
            - 2  成功     --- 表示请求已被成功接收、理解、接受
            - 3  重定向    -- 要完成请求必须进行更进一步的操作
                - 301 永久重定向 
                - 302 临时重定向 -- 跳转
                - 305 超空间移动  -- 代理
                - 307 临时跳转

            - 4  客户端错误 -- 请求的语法错误或请求无法实现
                - 400 错误请求
                - 402 收费
                - 403 服务器拒绝 
                - 404 找不到
                - 406 请求不接受
                - 408 超时
                - 409 访问冲突
                - 410 资源不见了
                - 413 响应实体过大
                - 417 请求无法满足
                - 418 一个玩笑，茶壶控制协议
                - 420 请求执行失败
                - 422 请求有错误

            - 5  服务端错误 -- 服务器未能实现合法的请求
                - 500 服务器内部错误
        - 请求报头

            ```
            Accept   告诉服务器接受的类型 text/html application/json
            Accept-Encoding  gzip,  是否接受数据压缩
            Accept-Laguage   接受的语言 zh-CN,zh,q=0.9
            Connection    keep-alive (长连接)  
            Host    域名
            Referer  来源，上一个页面是谁，从哪里过来的. 可以用来检查盗链
            User-Agent  浏览器、操作系统信息，用于表明身份
            Cookie

            Content-Encoding    gzip
            Server           服务器使用的是什么
            Cache-Ctrol
            Date
            Expires
            Strict-Transport-Security

            ```
- cookie 与 session
    - cookie 是保存在客户端的一小段文本，随客户端没次请求服务端下发cookie，下次请求浏览器携带cookie到服务器
        - 可以实现免登录
        - 下发  `Set-Cookie: abc=123; path=/; domain=.baidu.com; ` 逐条下发
        - 浏览器端 `document.cookie` 查看修改 cookie
    - session 保存在服务端，由客户端和服务端共同维护
        - 和 cookie 配合使用，保证安全性，更加安全的要和 token 配合（token定时更新）

- http 缓存 
    - 缓存会根据请求保存输出内容的副本,
    
    ```
    浏览器请求 --> 无缓存 --> 向web服务器请求 --> 请求响应，协商缓存 --> 显现

    # 缓存协商
    - Date
    - Cache-Control
    - Expires
    - Etag
    - Last-Modified

    ```

    - 强制缓存：服务器通知浏览器一个缓存时间，在缓存时间内直接使用缓存内容，超过时间使用比较缓存
    - 比较缓存: 将缓存信息中的Etag 和 Last-Modified 通过请求，发送服务器校验，返回 304 状态码时，直接使用缓存 
        - Etag/if-None-Match (优先)
        - Last-Modified/If-Modified-Since

    